# TASK-0025: C-03 OIDCã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0025
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - Critical ä¿®æ­£
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *C-03: CallbackPage.tsx ã¨ auth.ts ã®å®Ÿè£…ã‹ã‚‰ç¢ºèª*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/code-review-remediation/requirements.md) - REQ-CR-005
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/code-review-remediation/architecture.md)
- **APIä»•æ§˜**: [ğŸ”Œ api-endpoints.md](../../design/code-review-remediation/api-endpoints.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

CallbackPage.tsx ã§ authService.handleCallback() ã‚’ useEffect å†…ã§å‘¼ã³å‡ºã—ã€OIDC PKCE ãƒ•ãƒ­ãƒ¼ã‚’å®Œçµã•ã›ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: ãªã—
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0037 (H-08 Token refresh), TASK-0038 (H-09 ProtectedRoute)

## å®Œäº†æ¡ä»¶

- [ ] CallbackPage ã§ authService.handleCallback() ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨
- [ ] èªè¨¼æˆåŠŸå¾Œã«ãƒ›ãƒ¼ãƒ ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã“ã¨
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚¨ãƒ©ãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
- [ ] ãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦ãƒ‘ã‚¹ã™ã‚‹ã“ã¨
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå£Šã‚Œã¦ã„ãªã„ã“ã¨ï¼ˆå›å¸°ãƒ†ã‚¹ãƒˆï¼‰

---

## å®Ÿè£…è©³ç´°

1. ğŸ”µ frontend/src/pages/CallbackPage.tsx ã« useEffect ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ 
2. ğŸ”µ useEffect å†…ã§ authService.handleCallback() ã‚’å‘¼ã³å‡ºã—
3. ğŸ”µ æˆåŠŸæ™‚ã¯ãƒ›ãƒ¼ãƒ ç”»é¢ï¼ˆ'/'ï¼‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
4. ğŸŸ¡ ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆEDGE-CR-002ï¼‰

### ã‚³ãƒ¼ãƒ‰ä¾‹

```typescript
useEffect(() => {
  const processCallback = async () => {
    try {
      await authService.handleCallback();
      navigate('/');
    } catch (error) {
      setError('èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };
  processCallback();
}, []);
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

- ğŸ”µ handleCallback æˆåŠŸæ™‚ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç¢ºèª
- ğŸŸ¡ handleCallback å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç¢ºèª
- ğŸ”µ useEffect ãŒ1å›ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ
1. `/tsumiki:tdd-requirements TASK-0025` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- authService.handleCallback() ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ãƒ¡ã‚½ãƒƒãƒ‰
- LIFF WebView ã§ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã¯å®Ÿè£…æ™‚ã«æ¤œè¨¼ãŒå¿…è¦

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 3 | 1 | 0 | 4 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 2 | 1 | 0 | 3 |

**å“è³ªè©•ä¾¡**: ä¸»è¦ãªå®Ÿè£…ãƒ‘ã‚¹ã¯ğŸ”µã§æ˜ç¢ºã€‚ğŸŸ¡ã¯ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è©³ç´°ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã€å®Ÿè£…æ™‚ã«ç¢ºå®šå¯èƒ½ã€‚
