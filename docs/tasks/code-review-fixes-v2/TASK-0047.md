# TASK-0047: 設定整合性統一（環境変数名・OIDCクライアントID）

**タスクID**: TASK-0047
**タスクタイプ**: DIRECT
**推定工数**: 4時間
**フェーズ**: Phase 2 - High修正
**信頼性レベル**: 🔵 *H-04, H-06: ユーザヒアリングで統一方針を確認*

## 関連文書

- **概要**: [📋 overview.md](overview.md)
- **要件定義**: [📋 requirements.md](../../spec/code-review-fixes-v2/requirements.md) - REQ-V2-051, REQ-V2-053
- **設計文書**: [📐 architecture.md](../../design/code-review-fixes-v2/architecture.md)

## タスク概要

環境変数名 `VITE_API_BASE_URL` とOIDCクライアントID `liff-client` を全レイヤーで統一する。deploy.yml と E2E テストフィクスチャの修正が主な対象。

## 依存タスク

- **前提タスク**: なし（独立タスク）
- **後続タスク**: なし

## 完了条件

- [ ] deploy.yml の環境変数名が `VITE_API_BASE_URL` に統一されている
- [ ] deploy.yml の OIDC クライアント ID が `liff-client` に統一されている
- [ ] E2E テストフィクスチャのクライアント ID が `liff-client` に統一されている
- [ ] 全レイヤーで設定値が一致していることを確認

---

## 主要実装項目

### 1. 環境変数名統一 (H-04) 🔵

**信頼性**: 🔵 *H-04: api.ts L14 が `VITE_API_BASE_URL`、deploy.yml L91/L169 が `VITE_API_URL`。ユーザヒアリングで `VITE_API_BASE_URL` 統一に決定*

**実装ファイル**: `.github/workflows/deploy.yml`

```yaml
# Before (L91, L169):
VITE_API_URL: ${{ steps.deploy.outputs.api_url }}

# After:
VITE_API_BASE_URL: ${{ steps.deploy.outputs.api_url }}
```

### 2. OIDC クライアントID統一 - deploy.yml (H-06) 🔵

**信頼性**: 🔵 *H-06: realm-export.json/template.yaml L213 は `liff-client`、deploy.yml L95 は `memoru-liff`。ユーザヒアリングで `liff-client` 統一に決定*

**実装ファイル**: `.github/workflows/deploy.yml`

```yaml
# Before (L95):
VITE_OIDC_CLIENT_ID: memoru-liff

# After:
VITE_OIDC_CLIENT_ID: liff-client
```

### 3. OIDC クライアントID統一 - E2Eテスト (H-06) 🔵

**信頼性**: 🔵 *H-06: auth.fixture.ts L32 は `memoru-liff`*

**実装ファイル**: `frontend/e2e/fixtures/auth.fixture.ts`

```typescript
// Before (L32):
const clientId = 'memoru-liff';

// After:
const clientId = 'liff-client';
```

### 4. 整合性確認 🔵

**信頼性**: 🔵 *H-06: 全レイヤーの設定値確認*

変更不要（正の値）の確認:
- `infrastructure/keycloak/realm-export.json`: `liff-client` ✓
- `backend/template.yaml L213`: `liff-client` ✓
- `frontend/src/services/api.ts L14`: `VITE_API_BASE_URL` ✓

---

## 基本的なテスト要件

### 設定値整合性チェック 🔵

**信頼性**: 🔵 *H-04, H-06: 全ファイルの設定値一致確認*

- deploy.yml の `VITE_API_BASE_URL` と api.ts の参照が一致すること
- 全ファイルの OIDC クライアントIDが `liff-client` で統一されていること
- grep/検索で `memoru-liff`（旧値）や `VITE_API_URL`（旧変数名）が残存していないこと

---

## 実装手順

### DIRECTタスク

1. `/tsumiki:direct-setup` - 直接実装・設定
2. `/tsumiki:direct-verify` - 動作確認・品質確認

---

## 信頼性レベルサマリー

- **総項目数**: 5項目
- 🔵 **青信号**: 5項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: ✅ 高品質
