# TASK-0014: ホーム画面・ナビゲーション

**タスクID**: TASK-0014
**タスクタイプ**: TDD
**推定工数**: 6時間
**フェーズ**: Phase 3 - フロントエンド実装
**信頼性レベル**: 🟡 *要件から妥当な推測*

## 関連文書
- **概要**: [overview.md](overview.md)
- **要件定義**: [requirements.md](../../spec/memoru-liff/requirements.md) - NFR-201, NFR-202
- **設計文書**: [architecture.md](../../design/memoru-liff/architecture.md)

## タスク概要
ホーム画面とナビゲーションメニューを実装する。復習待ちカード数の表示、各機能へのナビゲーションを提供し、モバイルファーストなUIを構築する。

## 依存タスク
- **前提タスク**: TASK-0012（認証連携）, TASK-0013（React基盤）
- **後続タスク**: TASK-0015, TASK-0016, TASK-0017, TASK-0018, TASK-0019

## 完了条件
- [x] ホーム画面UI実装
- [x] 復習待ちカード数表示機能
- [x] ナビゲーションメニュー実装
- [x] 単体テスト80%以上のカバレッジ達成

---

## 実装詳細

### 1. ホーム画面 🟡
**信頼性**: 🟡 *要件から妥当な推測*

ホーム画面のメインUIを実装する。

```typescript
// frontend/src/pages/HomePage.tsx
import { useEffect } from 'react';
import { Link } from 'react-router-dom';
import { useCardsContext } from '../contexts/CardsContext';
import { useAuthContext } from '../contexts/AuthContext';
import { Navigation } from '../components/Navigation';
import { Loading } from '../components/common/Loading';

export const HomePage = () => {
  const { user } = useAuthContext();
  const { dueCount, fetchDueCount, isLoading } = useCardsContext();

  useEffect(() => {
    fetchDueCount();
  }, [fetchDueCount]);

  if (isLoading) {
    return <Loading message="読み込み中..." />;
  }

  return (
    <div className="flex flex-col h-full">
      <header className="bg-white shadow-sm p-4 mb-6">
        <h1 className="text-xl font-bold text-gray-800">Memoru</h1>
        <p className="text-sm text-gray-600">
          こんにちは、{user?.profile?.name ?? 'ユーザー'}さん
        </p>
      </header>

      <div className="flex-1 px-4">
        {/* 復習カード数表示 */}
        <div className="bg-white rounded-lg shadow p-6 mb-6">
          <h2 className="text-lg font-semibold text-gray-700 mb-2">
            今日の復習
          </h2>
          <div className="flex items-center justify-between">
            <span className="text-3xl font-bold text-blue-600">
              {dueCount}
            </span>
            <span className="text-gray-500">枚のカード</span>
          </div>
          {dueCount > 0 && (
            <Link
              to="/cards"
              className="mt-4 block w-full py-3 bg-blue-600 text-white text-center rounded-lg hover:bg-blue-700 active:bg-blue-800 min-h-[44px]"
            >
              復習を始める
            </Link>
          )}
        </div>

        {/* クイックアクション */}
        <div className="grid grid-cols-2 gap-4">
          <Link
            to="/generate"
            className="bg-white rounded-lg shadow p-4 flex flex-col items-center justify-center min-h-[100px] hover:bg-gray-50 active:bg-gray-100"
          >
            <svg className="h-8 w-8 text-green-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
            <span className="text-sm font-medium text-gray-700">カード作成</span>
          </Link>

          <Link
            to="/cards"
            className="bg-white rounded-lg shadow p-4 flex flex-col items-center justify-center min-h-[100px] hover:bg-gray-50 active:bg-gray-100"
          >
            <svg className="h-8 w-8 text-blue-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            <span className="text-sm font-medium text-gray-700">カード一覧</span>
          </Link>
        </div>
      </div>

      <Navigation />
    </div>
  );
};
```

**実装ファイル**: `frontend/src/pages/HomePage.tsx`

### 2. ナビゲーションコンポーネント 🟡
**信頼性**: 🟡 *要件から妥当な推測*

フッターナビゲーションを実装する。

```typescript
// frontend/src/components/Navigation.tsx
import { Link, useLocation } from 'react-router-dom';

interface NavItem {
  path: string;
  label: string;
  icon: JSX.Element;
}

export const Navigation = () => {
  const location = useLocation();

  const navItems: NavItem[] = [
    {
      path: '/',
      label: 'ホーム',
      icon: (
        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      ),
    },
    {
      path: '/generate',
      label: '作成',
      icon: (
        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
        </svg>
      ),
    },
    {
      path: '/cards',
      label: 'カード',
      icon: (
        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
      ),
    },
    {
      path: '/settings',
      label: '設定',
      icon: (
        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      ),
    },
  ];

  const isActive = (path: string) => {
    if (path === '/') {
      return location.pathname === '/';
    }
    return location.pathname.startsWith(path);
  };

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 safe-area-inset-bottom">
      <div className="flex justify-around items-center h-16 max-w-md mx-auto">
        {navItems.map((item) => (
          <Link
            key={item.path}
            to={item.path}
            className={`flex flex-col items-center justify-center w-full h-full min-w-[44px] min-h-[44px] ${
              isActive(item.path)
                ? 'text-blue-600'
                : 'text-gray-500 hover:text-gray-700'
            }`}
          >
            {item.icon}
            <span className="text-xs mt-1">{item.label}</span>
          </Link>
        ))}
      </div>
    </nav>
  );
};
```

**実装ファイル**: `frontend/src/components/Navigation.tsx`

### 3. due_count API連携 🔵
**信頼性**: 🔵 *architecture.mdより*

復習待ちカード数を取得するAPI連携を実装する。

```typescript
// frontend/src/services/api.ts (部分)
export const cardsApi = {
  // ... 他のメソッド

  getDueCount: async (): Promise<number> => {
    const response = await apiClient.get<{ count: number }>('/cards/due-count');
    return response.data.count;
  },
};
```

**実装ファイル**: `frontend/src/services/api.ts`

---

## 単体テスト要件

### テストケース1: ホーム画面の表示 🟡
**信頼性**: 🟡 *要件から妥当な推測*
**Given**: 認証済みユーザーがホーム画面にアクセス
**When**: ホーム画面が表示される
**Then**: ユーザー名と復習待ちカード数が表示される

### テストケース2: 復習待ちカード数表示 🔵
**信頼性**: 🔵 *architecture.mdより*
**Given**: APIから復習待ちカード数を取得
**When**: 取得に成功した場合
**Then**: カード数が正しく表示される

### テストケース3: 復習待ちカードがない場合 🟡
**信頼性**: 🟡 *要件から妥当な推測*
**Given**: 復習待ちカード数が0
**When**: ホーム画面が表示される
**Then**: 「復習を始める」ボタンが非表示

### テストケース4: ナビゲーションのアクティブ状態 🟡
**信頼性**: 🟡 *要件から妥当な推測*
**Given**: 特定のページにアクセス中
**When**: ナビゲーションが表示される
**Then**: 該当するナビゲーションアイテムがアクティブ状態になる

### テストケース5: ナビゲーションの画面遷移 🟡
**信頼性**: 🟡 *要件から妥当な推測*
**Given**: ナビゲーションメニューが表示されている
**When**: ナビゲーションアイテムをタップ
**Then**: 対応する画面に遷移する

### テストケース6: ローディング状態 🔵
**信頼性**: 🔵 *NFR-201より*
**Given**: データ取得中
**When**: ホーム画面にアクセス
**Then**: ローディングスピナーが表示される

---

## UI/UX要件

### ローディング状態 🔵
**信頼性**: 🔵 *NFR-201より*
- データ取得中はスピナーを表示
- 「読み込み中...」のメッセージを併記

### エラー表示 🟡
**信頼性**: 🟡 *要件から妥当な推測*
- API取得エラー時はエラーメッセージを表示
- 再試行ボタンを配置

### モバイル対応 🔵
**信頼性**: 🔵 *NFR-201より*
- モバイルファーストデザイン
- タップ領域は44px以上を確保
- LINE WebView最適化（safe-area対応）
- フッターナビゲーションは画面下部に固定

### 空状態 🟡
**信頼性**: 🟡 *要件から妥当な推測*
- 復習待ちカードがない場合は適切なメッセージを表示
- カード作成を促すアクションを提示

---

## 実装手順

### TDDタスクの場合
1. `/tsumiki:tdd-requirements TASK-0014` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項
- LINE WebViewでの動作確認を忘れずに行う
- safe-area-insetに対応してフッターナビゲーションを配置する
- タッチ操作に適したサイズ（44px以上）を確保する
- ダークモードは現時点ではサポート外とする

---

## 信頼性レベルサマリー
- 🔵 **青信号**: 5項目
- 🟡 **黄信号**: 7項目
- 🔴 **赤信号**: 0項目

**品質評価**: 要改善（黄信号項目の詳細確認が必要）
