# TASK-0010: LINE Webhookãƒ»Postbackå‡¦ç†å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0010
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 8æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *api-endpoints.mdãƒ»dataflow.mdã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸
- **æ¦‚è¦**: [overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [requirements.md](../../spec/memoru-liff/requirements.md) - REQ-051, REQ-412, REQ-413
- **è¨­è¨ˆæ–‡æ›¸**: [architecture.md](../../design/memoru-liff/architecture.md)
- **APIä»•æ§˜**: [api-endpoints.md](../../design/memoru-liff/api-endpoints.md)
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: [dataflow.md](../../design/memoru-liff/dataflow.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦
LINE Messaging APIã‹ã‚‰ã®Webhookã‚’å—ä¿¡ã—ã€Postbackã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå¾©ç¿’é–‹å§‹ã€è§£ç­”è¡¨ç¤ºã€æˆç¸¾è¨˜éŒ²ï¼‰ã‚’å‡¦ç†ã™ã‚‹Lambdaé–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹ã€‚ç½²åæ¤œè¨¼ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å¤‰æ›ã€Flex Messageé€ä¿¡ãªã©LINE Botæ©Ÿèƒ½ã®ä¸­æ ¸ã‚’æ‹…ã†ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯
- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0008ï¼ˆSM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ»å¾©ç¿’APIå®Ÿè£…ï¼‰
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0011ï¼ˆå®šæœŸé€šçŸ¥Lambdaå®Ÿè£…ï¼‰

## å®Œäº†æ¡ä»¶
- [ ] POST /webhook/line å®Ÿè£…
- [ ] X-Line-Signatureç½²åæ¤œè¨¼å®Ÿè£…
- [ ] Postbackå‡¦ç†ï¼ˆstart, reveal, gradeï¼‰å®Ÿè£…
- [ ] Flex Messageé€ä¿¡å®Ÿè£…
- [ ] line_user_id â†’ user_idå¤‰æ›å®Ÿè£…
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## å®Ÿè£…è©³ç´°

### 1. POST /webhook/line ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *api-endpoints.mdã‚ˆã‚Š*

LINE Platformã‹ã‚‰ã®Webhookã‚’å—ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆLINEã‹ã‚‰ï¼‰**:
```json
{
  "destination": "xxxxxxxxxx",
  "events": [
    {
      "type": "postback",
      "timestamp": 1704067200000,
      "source": {
        "type": "user",
        "userId": "U1234567890abcdef..."
      },
      "replyToken": "nHuyWiB7yP5Zw52FIkcQobQuGDXCTA",
      "postback": {
        "data": "action=start"
      }
    }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
- 200 OKï¼ˆç©ºãƒœãƒ‡ã‚£ï¼‰: æ­£å¸¸å‡¦ç†
- 400 Bad Request: ç½²åæ¤œè¨¼å¤±æ•—

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. X-Line-Signatureæ¤œè¨¼
2. ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ã®åˆ¤å®š
3. Postbackã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†
4. å¿…è¦ã«å¿œã˜ã¦Reply Messageé€ä¿¡

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/handler.py`

### 2. X-Line-Signatureç½²åæ¤œè¨¼å®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *LINE Messaging APIä»•æ§˜ã‚ˆã‚Š*

LINE Platformã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ç½²åæ¤œè¨¼ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**æ¤œè¨¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:
```python
import hmac
import hashlib
import base64

def verify_signature(body: str, signature: str, channel_secret: str) -> bool:
    """
    LINEç½²åã‚’æ¤œè¨¼

    Args:
        body: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆæ–‡å­—åˆ—ï¼‰
        signature: X-Line-Signatureãƒ˜ãƒƒãƒ€ãƒ¼å€¤
        channel_secret: LINE Channel Secret

    Returns:
        bool: æ¤œè¨¼æˆåŠŸãªã‚‰True
    """
    hash = hmac.new(
        channel_secret.encode('utf-8'),
        body.encode('utf-8'),
        hashlib.sha256
    ).digest()
    expected = base64.b64encode(hash).decode('utf-8')
    return hmac.compare_digest(signature, expected)
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/middleware/signature.py`

### 3. Postbackå‡¦ç†å®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*

3ç¨®é¡ã®Postbackã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†ã™ã‚‹ã€‚

**Postbackç¨®åˆ¥**:

#### 3.1 action=startï¼ˆå¾©ç¿’é–‹å§‹ï¼‰
```
postback.data: "action=start"
```
**å‡¦ç†**:
1. line_user_idã‹ã‚‰user_idã‚’å–å¾—
2. æœŸé™ã‚«ãƒ¼ãƒ‰ï¼ˆdueï¼‰ã‚’å–å¾—
3. æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã‚’Flex Messageã§é€ä¿¡

#### 3.2 action=revealï¼ˆè§£ç­”è¡¨ç¤ºï¼‰
```
postback.data: "action=reveal&card_id=xxx"
```
**å‡¦ç†**:
1. card_idã‹ã‚‰ã‚«ãƒ¼ãƒ‰æƒ…å ±å–å¾—
2. è§£ç­”ï¼ˆbackï¼‰ã‚’å«ã‚€Flex Messageé€ä¿¡
3. æˆç¸¾å…¥åŠ›ãƒœã‚¿ãƒ³ï¼ˆ0-5ï¼‰ã‚’è¡¨ç¤º

#### 3.3 action=gradeï¼ˆæˆç¸¾è¨˜éŒ²ï¼‰
```
postback.data: "action=grade&card_id=xxx&grade=4"
```
**å‡¦ç†**:
1. POST /reviews/:card_idã‚’å†…éƒ¨å‘¼ã³å‡ºã—
2. æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Œã°è¡¨ç¤º
3. ãªã‘ã‚Œã°å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/handlers/postback.py`

### 4. Flex Message ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *requirements.mdã‚ˆã‚Š*

å¾©ç¿’ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºç”¨ã®Flex Messageãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å•é¡Œè¡¨ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
```json
{
  "type": "bubble",
  "header": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "å¾©ç¿’ã‚«ãƒ¼ãƒ‰",
        "weight": "bold",
        "size": "lg"
      }
    ]
  },
  "body": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "{front}",
        "wrap": true,
        "size": "md"
      }
    ]
  },
  "footer": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "button",
        "action": {
          "type": "postback",
          "label": "è§£ç­”ã‚’è¦‹ã‚‹",
          "data": "action=reveal&card_id={card_id}"
        },
        "style": "primary"
      }
    ]
  }
}
```

**è§£ç­”ãƒ»æˆç¸¾å…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
```json
{
  "type": "bubble",
  "body": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "å•é¡Œ",
        "weight": "bold"
      },
      {
        "type": "text",
        "text": "{front}",
        "wrap": true
      },
      {
        "type": "separator"
      },
      {
        "type": "text",
        "text": "è§£ç­”",
        "weight": "bold"
      },
      {
        "type": "text",
        "text": "{back}",
        "wrap": true
      }
    ]
  },
  "footer": {
    "type": "box",
    "layout": "horizontal",
    "contents": [
      {
        "type": "button",
        "action": {
          "type": "postback",
          "label": "0",
          "data": "action=grade&card_id={card_id}&grade=0"
        },
        "style": "secondary",
        "flex": 1
      },
      // ... grade 1-5 buttons
    ]
  }
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/templates/flex_messages.py`

### 5. line_user_id â†’ user_id å¤‰æ› ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*

LINE UserIDã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ å†…ã®user_idã‚’å–å¾—ã™ã‚‹å¤‰æ›å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å‡¦ç†**:
```python
def get_user_id_from_line(line_user_id: str) -> Optional[str]:
    """
    LINE UserIDã‹ã‚‰user_idã‚’å–å¾—

    Returns:
        user_id: è¦‹ã¤ã‹ã£ãŸå ´åˆ
        None: æœªé€£æºã®å ´åˆ
    """
    # DynamoDB GSI (line_user_id-index) ã§æ¤œç´¢
    pass
```

**æœªé€£æºãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‡¦ç†**:
- é€£æºæ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
- LIFFã‚¢ãƒ—ãƒªã¸ã®èª˜å°ãƒªãƒ³ã‚¯ã‚’å«ã‚ã‚‹

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/services/user_service.py`

### 6. LINE Messaging API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

Reply Messageã€Push Messageã‚’é€ä¿¡ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å®Ÿè£…å†…å®¹**:
```python
class LineClient:
    def __init__(self, channel_access_token: str):
        self.token = channel_access_token
        self.api_url = "https://api.line.me/v2/bot"

    def reply_message(self, reply_token: str, messages: list) -> bool:
        """Reply Tokenã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡"""
        pass

    def push_message(self, to: str, messages: list) -> bool:
        """Push Messageã§æŒ‡å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€ä¿¡"""
        pass
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/functions/line_webhook/services/line_client.py`

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ç½²åæ¤œè¨¼æˆåŠŸ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *LINE Messaging APIä»•æ§˜ã‚ˆã‚Š*
**Given**: æ­£ã—ã„Channel Secretã¨ç½²å
**When**: verify_signature ã‚’å‘¼ã³å‡ºã™
**Then**: True ãŒè¿”å´

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ç½²åæ¤œè¨¼å¤±æ•— - ä¸æ­£ãªç½²å ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *LINE Messaging APIä»•æ§˜ã‚ˆã‚Š*
**Given**: æ­£ã—ã„Channel Secretã€ä¸æ­£ãªç½²å
**When**: verify_signature ã‚’å‘¼ã³å‡ºã™
**Then**: False ãŒè¿”å´

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ç½²åæ¤œè¨¼å¤±æ•— - ç½²åãªã— ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *LINE Messaging APIä»•æ§˜ã‚ˆã‚Š*
**Given**: X-Line-Signatureãƒ˜ãƒƒãƒ€ãƒ¼ãªã—ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
**When**: POST /webhook/line ã‚’å‘¼ã³å‡ºã™
**Then**: 400 Bad Request

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹4: Postback startå‡¦ç†æˆåŠŸ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: é€£æºæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€å¾©ç¿’æœŸé™ã‚«ãƒ¼ãƒ‰ã‚ã‚Š
**When**: action=start ã®Postback
**Then**: æœ€åˆã®ã‚«ãƒ¼ãƒ‰ãŒFlex Messageã§é€ä¿¡

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹5: Postback start - æœŸé™ã‚«ãƒ¼ãƒ‰ãªã— ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: é€£æºæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€å¾©ç¿’æœŸé™ã‚«ãƒ¼ãƒ‰ãªã—
**When**: action=start ã®Postback
**Then**: ã€Œå¾©ç¿’ã™ã‚‹ã‚«ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹6: Postback revealå‡¦ç†æˆåŠŸ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: æœ‰åŠ¹ãªcard_id
**When**: action=reveal&card_id=xxx ã®Postback
**Then**: è§£ç­”ã¨æˆç¸¾ãƒœã‚¿ãƒ³ã‚’å«ã‚€Flex Messageé€ä¿¡

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹7: Postback gradeå‡¦ç†æˆåŠŸ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: æœ‰åŠ¹ãªcard_idã€grade=4
**When**: action=grade&card_id=xxx&grade=4 ã®Postback
**Then**: SM-2æ›´æ–°ã€æ¬¡ã‚«ãƒ¼ãƒ‰è¡¨ç¤º

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹8: Postback grade - æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: æœ€å¾Œã®å¾©ç¿’ã‚«ãƒ¼ãƒ‰ã€grade=5
**When**: action=grade ã®Postback
**Then**: å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œæœ¬æ—¥ã®å¾©ç¿’ãŒå®Œäº†ã—ã¾ã—ãŸã€

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹9: æœªé€£æºãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Postback ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *requirements.mdã‚ˆã‚Š*
**Given**: LINEæœªé€£æºã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
**When**: ä»»æ„ã®Postback
**Then**: é€£æºæ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨LIFFãƒªãƒ³ã‚¯é€ä¿¡

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹10: ä¸æ­£ãªPostbackãƒ‡ãƒ¼ã‚¿ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *api-endpoints.mdã‚ˆã‚Š*
**Given**: action=invalid ãªã©ã®ä¸æ­£ãƒ‡ãƒ¼ã‚¿
**When**: Postbackå‡¦ç†
**Then**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ã‹ã‚Šã‚„ã™ãï¼‰

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹11: Flex Messageç”Ÿæˆ - å•é¡Œè¡¨ç¤º ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *requirements.mdã‚ˆã‚Š*
**Given**: ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆfront="å•é¡Œæ–‡"ï¼‰
**When**: å•é¡Œè¡¨ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
**Then**: æ­£ã—ã„Flex Message JSON

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹12: Flex Messageç”Ÿæˆ - è§£ç­”è¡¨ç¤º ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *requirements.mdã‚ˆã‚Š*
**Given**: ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆfront="å•é¡Œæ–‡", back="è§£ç­”"ï¼‰
**When**: è§£ç­”è¡¨ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
**Then**: æˆç¸¾ãƒœã‚¿ãƒ³0-5ã‚’å«ã‚€Flex Message JSON

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹13: line_user_idå¤‰æ›æˆåŠŸ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: é€£æºæ¸ˆã¿ã®line_user_id
**When**: get_user_id_from_line ã‚’å‘¼ã³å‡ºã™
**Then**: å¯¾å¿œã™ã‚‹user_idãŒè¿”å´

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹14: line_user_idå¤‰æ›å¤±æ•— ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**Given**: æœªé€£æºã®line_user_id
**When**: get_user_id_from_line ã‚’å‘¼ã³å‡ºã™
**Then**: None ãŒè¿”å´

---

## çµ±åˆãƒ†ã‚¹ãƒˆè¦ä»¶

### çµ±åˆãƒ†ã‚¹ãƒˆ1: å¾©ç¿’å®Œå…¨ãƒ•ãƒ­ãƒ¼ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**ãƒ†ã‚¹ãƒˆå†…å®¹**: start â†’ reveal â†’ grade ã®ä¸€é€£ã®ãƒ•ãƒ­ãƒ¼ãŒLINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦æ­£å¸¸ã«å‹•ä½œ

### çµ±åˆãƒ†ã‚¹ãƒˆ2: LINE APIå®Ÿæ¥ç¶šãƒ†ã‚¹ãƒˆ ğŸŸ¡
**ä¿¡é ¼æ€§**: ğŸŸ¡ *å®Ÿç’°å¢ƒä¾å­˜*
**ãƒ†ã‚¹ãƒˆå†…å®¹**: å®Ÿéš›ã®LINE Messaging APIã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆæ‰‹å‹•å®Ÿè¡Œï¼‰

### çµ±åˆãƒ†ã‚¹ãƒˆ3: SM-2æ›´æ–°ã¨ã®é€£æºç¢ºèª ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *dataflow.mdã‚ˆã‚Š*
**ãƒ†ã‚¹ãƒˆå†…å®¹**: grade Postbackå¾Œã«ã‚«ãƒ¼ãƒ‰ã®SM-2ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ
1. `/tsumiki:tdd-requirements TASK-0010` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …
- Channel Secretã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã—ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãªã„
- ç½²åæ¤œè¨¼ã¯å¿…ãšãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®æœ€åˆã«è¡Œã†
- Reply Tokenã¯1å›ã®ã¿æœ‰åŠ¹ã€30ç§’ã§æœŸé™åˆ‡ã‚Œ
- Flex Messageã¯LINEå…¬å¼ã®Simulatorã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèªæ¨å¥¨
- æœ¬ç•ªç’°å¢ƒã§ã¯LINE Official Account Managerã§ã®è¨­å®šãŒå¿…è¦
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™: Reply Messageç„¡åˆ¶é™ã€Push Message 1,000é€š/æœˆï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼
- ğŸ”µ **é’ä¿¡å·**: 19é …ç›®
- ğŸŸ¡ **é»„ä¿¡å·**: 1é …ç›®ï¼ˆLINE APIå®Ÿæ¥ç¶šãƒ†ã‚¹ãƒˆï¼‰
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›®

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
