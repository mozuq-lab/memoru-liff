# TASK-0013: React ã‚¢ãƒ—ãƒªåŸºç›¤æ§‹ç¯‰

**ã‚¿ã‚¹ã‚¯ID**: TASK-0013
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: DIRECT
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸
- **æ¦‚è¦**: [overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [requirements.md](../../spec/memoru-liff/requirements.md) - NFR-201, NFR-202
- **è¨­è¨ˆæ–‡æ›¸**: [architecture.md](../../design/memoru-liff/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦
Vite + React + TypeScriptã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚React Contextã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã€React Routerã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€Tailwind CSSã®è¨­å®šã‚’è¡Œã†ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯
- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0004ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒæ§‹ç¯‰ï¼‰
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0014, TASK-0015, TASK-0016, TASK-0017, TASK-0018, TASK-0019

## å®Œäº†æ¡ä»¶
- [ ] Vite + React + TypeScriptåˆæœŸè¨­å®šå®Œäº†
- [ ] React Contextï¼ˆAuthContext, CardsContextï¼‰å®Ÿè£…
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆReact Routerï¼‰è¨­å®šå®Œäº†
- [ ] å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆLayout, Loading, Errorï¼‰å®Ÿè£…
- [ ] Tailwind CSSè¨­å®šå®Œäº†

---

## å®Ÿè£…è©³ç´°

### 1. Vite + React + TypeScriptè¨­å®š ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

Viteã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰è¨­å®šã¨TypeScriptè¨­å®šã‚’è¡Œã†ã€‚

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      },
    },
  },
});
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/vite.config.ts`, `frontend/tsconfig.json`

### 2. App.tsx ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/App.tsx
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { AuthProvider } from './contexts/AuthContext';
import { CardsProvider } from './contexts/CardsContext';
import { Layout } from './components/common/Layout';
import { ProtectedRoute } from './components/common/ProtectedRoute';
import { HomePage } from './pages/HomePage';
import { GeneratePage } from './pages/GeneratePage';
import { CardsPage } from './pages/CardsPage';
import { CardDetailPage } from './pages/CardDetailPage';
import { SettingsPage } from './pages/SettingsPage';
import { LinkLinePage } from './pages/LinkLinePage';
import { CallbackPage } from './pages/CallbackPage';

function App() {
  return (
    <Router>
      <AuthProvider>
        <CardsProvider>
          <Layout>
            <Routes>
              <Route path="/callback" element={<CallbackPage />} />
              <Route path="/" element={<ProtectedRoute><HomePage /></ProtectedRoute>} />
              <Route path="/generate" element={<ProtectedRoute><GeneratePage /></ProtectedRoute>} />
              <Route path="/cards" element={<ProtectedRoute><CardsPage /></ProtectedRoute>} />
              <Route path="/cards/:id" element={<ProtectedRoute><CardDetailPage /></ProtectedRoute>} />
              <Route path="/settings" element={<ProtectedRoute><SettingsPage /></ProtectedRoute>} />
              <Route path="/link-line" element={<ProtectedRoute><LinkLinePage /></ProtectedRoute>} />
            </Routes>
          </Layout>
        </CardsProvider>
      </AuthProvider>
    </Router>
  );
}

export default App;
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/App.tsx`

### 3. AuthContext å®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹Contextã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/contexts/AuthContext.tsx
import { createContext, useContext, ReactNode } from 'react';
import { User } from 'oidc-client-ts';
import { useAuth } from '../hooks/useAuth';

interface AuthContextType {
  user: User | null;
  isLoading: boolean;
  isAuthenticated: boolean;
  error: Error | null;
  login: () => Promise<void>;
  logout: () => Promise<void>;
  refreshToken: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

interface AuthProviderProps {
  children: ReactNode;
}

export const AuthProvider = ({ children }: AuthProviderProps) => {
  const auth = useAuth();

  return (
    <AuthContext.Provider value={auth}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuthContext = (): AuthContextType => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuthContext must be used within an AuthProvider');
  }
  return context;
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/contexts/AuthContext.tsx`

### 4. CardsContext å®Ÿè£… ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

ã‚«ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹Contextã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/contexts/CardsContext.tsx
import { createContext, useContext, useState, ReactNode, useCallback } from 'react';
import { Card } from '../types/card';
import { cardsApi } from '../services/api';

interface CardsContextType {
  cards: Card[];
  isLoading: boolean;
  error: Error | null;
  fetchCards: () => Promise<void>;
  addCard: (card: Card) => void;
  updateCard: (id: string, updates: Partial<Card>) => void;
  deleteCard: (id: string) => void;
  dueCount: number;
  fetchDueCount: () => Promise<void>;
}

const CardsContext = createContext<CardsContextType | undefined>(undefined);

interface CardsProviderProps {
  children: ReactNode;
}

export const CardsProvider = ({ children }: CardsProviderProps) => {
  const [cards, setCards] = useState<Card[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  const [dueCount, setDueCount] = useState(0);

  const fetchCards = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const data = await cardsApi.getCards();
      setCards(data);
    } catch (err) {
      setError(err as Error);
    } finally {
      setIsLoading(false);
    }
  }, []);

  const addCard = useCallback((card: Card) => {
    setCards(prev => [...prev, card]);
  }, []);

  const updateCard = useCallback((id: string, updates: Partial<Card>) => {
    setCards(prev => prev.map(card =>
      card.id === id ? { ...card, ...updates } : card
    ));
  }, []);

  const deleteCard = useCallback((id: string) => {
    setCards(prev => prev.filter(card => card.id !== id));
  }, []);

  const fetchDueCount = useCallback(async () => {
    try {
      const count = await cardsApi.getDueCount();
      setDueCount(count);
    } catch (err) {
      console.error('Failed to fetch due count:', err);
    }
  }, []);

  return (
    <CardsContext.Provider value={{
      cards,
      isLoading,
      error,
      fetchCards,
      addCard,
      updateCard,
      deleteCard,
      dueCount,
      fetchDueCount,
    }}>
      {children}
    </CardsContext.Provider>
  );
};

export const useCardsContext = (): CardsContextType => {
  const context = useContext(CardsContext);
  if (context === undefined) {
    throw new Error('useCardsContext must be used within a CardsProvider');
  }
  return context;
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/contexts/CardsContext.tsx`

### 5. Layout ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/components/common/Layout.tsx
import { ReactNode } from 'react';

interface LayoutProps {
  children: ReactNode;
}

export const Layout = ({ children }: LayoutProps) => {
  return (
    <div className="min-h-screen bg-gray-50">
      <main className="container mx-auto px-4 py-6 max-w-md">
        {children}
      </main>
    </div>
  );
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/common/Layout.tsx`

### 6. Loading ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *NFR-201ã‚ˆã‚Š*

ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/components/common/Loading.tsx
interface LoadingProps {
  message?: string;
}

export const Loading = ({ message = 'èª­ã¿è¾¼ã¿ä¸­...' }: LoadingProps) => {
  return (
    <div className="flex flex-col items-center justify-center min-h-[200px]">
      <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"></div>
      <p className="mt-4 text-gray-600">{message}</p>
    </div>
  );
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/common/Loading.tsx`

### 7. Error ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *NFR-202ã‚ˆã‚Š*

ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/components/common/Error.tsx
interface ErrorProps {
  message: string;
  onRetry?: () => void;
}

export const Error = ({ message, onRetry }: ErrorProps) => {
  return (
    <div className="flex flex-col items-center justify-center min-h-[200px] p-4">
      <div className="text-red-500 text-lg mb-4">
        <svg className="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
      <p className="text-gray-700 text-center mb-4">{message}</p>
      {onRetry && (
        <button
          onClick={onRetry}
          className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 min-h-[44px]"
        >
          å†è©¦è¡Œ
        </button>
      )}
    </div>
  );
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/common/Error.tsx`

### 8. ProtectedRoute ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *architecture.mdã‚ˆã‚Š*

èªè¨¼ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒˆã‚’ä¿è­·ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

```typescript
// frontend/src/components/common/ProtectedRoute.tsx
import { ReactNode } from 'react';
import { useAuthContext } from '../../contexts/AuthContext';
import { Loading } from './Loading';
import { Error } from './Error';

interface ProtectedRouteProps {
  children: ReactNode;
}

export const ProtectedRoute = ({ children }: ProtectedRouteProps) => {
  const { isLoading, isAuthenticated, error, login } = useAuthContext();

  if (isLoading) {
    return <Loading message="èªè¨¼ä¸­..." />;
  }

  if (error) {
    return (
      <Error
        message="èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
        onRetry={login}
      />
    );
  }

  if (!isAuthenticated) {
    login();
    return <Loading message="ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•ä¸­..." />;
  }

  return <>{children}</>;
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/components/common/ProtectedRoute.tsx`

### 9. Tailwind CSSè¨­å®š ğŸ”µ
**ä¿¡é ¼æ€§**: ğŸ”µ *NFR-201ã‚ˆã‚Š*

Tailwind CSSã®è¨­å®šã‚’è¡Œã†ã€‚

```javascript
// frontend/tailwind.config.js
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        line: {
          green: '#00B900',
          dark: '#00C300',
        },
      },
      minHeight: {
        'touch': '44px',
      },
      minWidth: {
        'touch': '44px',
      },
    },
  },
  plugins: [],
};
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/tailwind.config.js`, `frontend/src/index.css`

---

## å®Ÿè£…æ‰‹é †

### DIRECTã‚¿ã‚¹ã‚¯ã®å ´åˆ
1. `/tsumiki:direct-setup` - ç›´æ¥å®Ÿè£…ãƒ»è¨­å®š
2. `/tsumiki:direct-verify` - å‹•ä½œç¢ºèªãƒ»å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …
- React 18ã®StrictModeã‚’æœ‰åŠ¹ã«ã—ã¦é–‹ç™ºã‚’è¡Œã†
- ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆ@/ï¼‰ã‚’ä½¿ç”¨ã—ã¦çµ¶å¯¾ãƒ‘ã‚¹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å®Ÿè£…ã™ã‚‹
- TypeScriptã®å‹å®šç¾©ã‚’å³å¯†ã«è¡Œã†
- Tailwind CSSã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’å„ªå…ˆã—ã¦ä½¿ç”¨ã™ã‚‹

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼
- ğŸ”µ **é’ä¿¡å·**: 9é …ç›®
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›®
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›®

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
