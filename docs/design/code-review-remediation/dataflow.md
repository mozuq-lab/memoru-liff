# code-review-remediation ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

**ä½œæˆæ—¥**: 2026-02-15
**é–¢é€£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [architecture.md](architecture.md)
**é–¢é€£è¦ä»¶å®šç¾©**: [requirements.md](../../spec/code-review-remediation/requirements.md)
**æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: [dataflow.md](../memoru-liff/dataflow.md)

**ã€ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«å‡¡ä¾‹ã€‘**:

- ğŸ”µ **é’ä¿¡å·**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ»æ—¢å­˜è¨­è¨ˆæ–‡æ›¸ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’å‚è€ƒã«ã—ãŸç¢ºå®Ÿãªãƒ•ãƒ­ãƒ¼
- ğŸŸ¡ **é»„ä¿¡å·**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ»æ—¢å­˜è¨­è¨ˆæ–‡æ›¸ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬ã«ã‚ˆã‚‹ãƒ•ãƒ­ãƒ¼
- ğŸ”´ **èµ¤ä¿¡å·**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœãƒ»æ—¢å­˜è¨­è¨ˆæ–‡æ›¸ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ’ã‚¢ãƒªãƒ³ã‚°ã«ãªã„æ¨æ¸¬ã«ã‚ˆã‚‹ãƒ•ãƒ­ãƒ¼

---

## ä¿®æ­£å¯¾è±¡ãƒ•ãƒ­ãƒ¼æ¦‚è¦

æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼ˆ`docs/design/memoru-liff/dataflow.md`ï¼‰ã®ã†ã¡ã€ä»¥ä¸‹ã®ãƒ•ãƒ­ãƒ¼ã«ä¿®æ­£ãŒå¿…è¦ï¼š

1. **èªè¨¼ãƒ•ãƒ­ãƒ¼** â€” OIDC ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œæˆã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥è¿½åŠ 
2. **LINE Webhook ãƒ•ãƒ­ãƒ¼** â€” ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚»ãƒ¼ãƒ•ç½²åæ¤œè¨¼
3. **ã‚«ãƒ¼ãƒ‰ä½œæˆãƒ•ãƒ­ãƒ¼** â€” Race Condition å¯¾ç­–
4. **å¾©ç¿’é€šçŸ¥ãƒ•ãƒ­ãƒ¼** â€” IAM æ¨©é™ä¿®æ­£å¾Œã® last_notified_date æ›´æ–°

---

## 1. ä¿®æ­£ç‰ˆ: OIDC èªè¨¼ãƒ•ãƒ­ãƒ¼ (C-03, C-07) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *C-03: OIDC ä»•æ§˜ãƒ»æ—¢å­˜è¨­è¨ˆã‚ˆã‚Š*

**é–¢é€£è¦ä»¶**: REQ-CR-005, REQ-CR-006

**å¤‰æ›´ç‚¹**: ã‚¹ãƒ†ãƒƒãƒ— 0ï¼ˆç’°å¢ƒå¤‰æ•°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã¨ ã‚¹ãƒ†ãƒƒãƒ— 8-12ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼‰ã‚’è¿½åŠ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼  â”‚     â”‚   LIFF   â”‚     â”‚ Keycloak â”‚     â”‚ LINE IdP â”‚
â”‚ (LINEå†…)  â”‚     â”‚ (React)  â”‚     â”‚(ECS/ALB) â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚ 1. LIFFã‚¢ã‚¯ã‚»ã‚¹ â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 0. [NEW] validateOidcConfig()   â”‚
     â”‚                â”‚    ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯               â”‚
     â”‚                â”‚    (ä¸å‚™æ™‚ã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤º)           â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 2. èªè¨¼çŠ¶æ…‹ç¢ºèª  â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 3. Authorization Request (PKCE) â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ 4-7. LINE Login ãƒ•ãƒ­ãƒ¼
     â”‚                â”‚                â”‚(æ—¢å­˜ã¨åŒä¸€)     â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 8. Authorization Code            â”‚
     â”‚                â”‚    (Callback URL)                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 9. [NEW] CallbackPage:           â”‚
     â”‚                â”‚    authService.handleCallback()  â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 10. Token Request (code+verifier)â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 11. JWT (access, refresh)        â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 12. JWTä¿å­˜ â†’ ãƒ›ãƒ¼ãƒ ç”»é¢          â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ 13. ãƒ›ãƒ¼ãƒ ç”»é¢  â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
```

---

## 2. æ–°è¦: ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ (H-08) ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *H-08: interceptor ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨­è¨ˆã¯ãƒ’ã‚¢ãƒªãƒ³ã‚°ã§ç¢ºå®šã€è©³ç´°ã¯æ¨æ¸¬*

**é–¢é€£è¦ä»¶**: REQ-CR-007, REQ-CR-102, REQ-CR-103

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼  â”‚     â”‚ ApiClientâ”‚     â”‚ Backend  â”‚     â”‚ Keycloak â”‚
â”‚          â”‚     â”‚(api.ts)  â”‚     â”‚(Lambda)  â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚ 1. æ“ä½œ        â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 2. API Request  â”‚                â”‚
     â”‚                â”‚   (æœŸé™åˆ‡ã‚ŒJWT) â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 3. 401 Unauthorized              â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 4. isRefreshing?                 â”‚
     â”‚                â”‚    No â†’ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–‹å§‹          â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 5. silentRenew()                â”‚
     â”‚                â”‚   (refresh_token)               â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 6. æ–° access_token              â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 7. ãƒªãƒˆãƒ©ã‚¤ (æ–°JWT)              â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 8. 200 OK      â”‚                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ 9. çµæœè¡¨ç¤º    â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
```

**ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®å‹•ä½œ**:

```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆA â†’ 401 â†’ isRefreshing=false â†’ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–‹å§‹ â†’ å¾…æ©Ÿ â†’ ãƒªãƒˆãƒ©ã‚¤
ãƒªã‚¯ã‚¨ã‚¹ãƒˆB â†’ 401 â†’ isRefreshing=true  â†’ åŒã˜Promiseå¾…æ©Ÿ  â†’ ãƒªãƒˆãƒ©ã‚¤
ãƒªã‚¯ã‚¨ã‚¹ãƒˆC â†’ 401 â†’ isRefreshing=true  â†’ åŒã˜Promiseå¾…æ©Ÿ  â†’ ãƒªãƒˆãƒ©ã‚¤

â€» ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¯1å›ã®ã¿å®Ÿè¡Œã€å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå…±æœ‰
```

**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¤±æ•—æ™‚**:

```
silentRenew() â†’ å¤±æ•— â†’ authService.login() â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

---

## 3. ä¿®æ­£ç‰ˆ: LINE ç½²åæ¤œè¨¼ãƒ•ãƒ­ãƒ¼ (C-06) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *C-06: hmac.compare_digest ã®ä»•æ§˜ã‚ˆã‚Š*

**é–¢é€£è¦ä»¶**: REQ-CR-009

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LINE Platformâ”‚   â”‚          line-webhook Lambda          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â”‚ Webhook Request â”‚
     â”‚ + X-Line-Signature
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚
     â”‚                â”‚ 1. signature ã‚’å–å¾—
     â”‚                â”‚    (null/ç©º â†’ ç©ºæ–‡å­—åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
     â”‚                â”‚
     â”‚                â”‚ 2. HMAC-SHA256 è¨ˆç®—
     â”‚                â”‚    expected = hmac(channel_secret, body)
     â”‚                â”‚
     â”‚                â”‚ 3. hmac.compare_digest(expected, signature)
     â”‚                â”‚    â€» å¸¸ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚»ãƒ¼ãƒ•ãªæ¯”è¼ƒã‚’å®Ÿè¡Œ
     â”‚                â”‚    â€» ç©ºç½²åã§ã‚‚æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã—ãªã„
     â”‚                â”‚
     â”‚                â”œâ”€â”€ True  â†’ 4. Postback å‡¦ç†ã¸
     â”‚                â”‚
     â”‚                â””â”€â”€ False â†’ 5. 403 Forbidden
     â”‚                â”‚
```

**Before (è„†å¼±)**:
```python
if not signature:
    return False  # â† æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±æ¼æ´©ï¼‰
return hmac.compare_digest(expected, signature)
```

**After (ä¿®æ­£å¾Œ)**:
```python
if signature is None:
    signature = ""  # ç©ºæ–‡å­—åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
return hmac.compare_digest(expected, signature)  # å¸¸ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚»ãƒ¼ãƒ•
```

---

## 4. ä¿®æ­£ç‰ˆ: ã‚«ãƒ¼ãƒ‰ä½œæˆãƒ•ãƒ­ãƒ¼ (H-06) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *H-06: DynamoDB ConditionExpression ã®ä»•æ§˜ã‚ˆã‚Š*

**é–¢é€£è¦ä»¶**: REQ-CR-015

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LIFF   â”‚     â”‚ Backend  â”‚     â”‚              DynamoDB             â”‚
â”‚ (React)  â”‚     â”‚(Lambda)  â”‚     â”‚                                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚
     â”‚ POST /cards    â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚
     â”‚                â”‚ TransactWriteItems               â”‚
     â”‚                â”‚   [                              â”‚
     â”‚                â”‚     Update users:                â”‚
     â”‚                â”‚       card_count = card_count+1  â”‚
     â”‚                â”‚       Condition: card_count<2000 â”‚  â† [NEW]
     â”‚                â”‚     Put cards: æ–°è¦ã‚«ãƒ¼ãƒ‰         â”‚
     â”‚                â”‚     Put reviews: åˆæœŸSRS         â”‚
     â”‚                â”‚   ]                              â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
     â”‚                â”‚                â”‚                 â”‚
     â”‚                â”‚                â”œâ”€â”€ æˆåŠŸ          â”‚
     â”‚                â”‚ 201 Created    â”‚                 â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
     â”‚                â”‚                â”‚                 â”‚
     â”‚                â”‚                â””â”€â”€ TransactionCanceled
     â”‚                â”‚                    (card_count >= 2000)
     â”‚                â”‚ 400 CARD_LIMIT_EXCEEDED          â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
     â”‚                â”‚                â”‚                 â”‚
```

**Race Condition é˜²æ­¢ã®ä»•çµ„ã¿**:

```
Time  Request A                    Request B
 |    TransactWriteItems           TransactWriteItems
 |    Condition: count<2000        Condition: count<2000
 |    (count=1999)                 (count=1999)
 |    â†’ æˆåŠŸ (countâ†’2000)         â†’ Conditionå¤±æ•—
 |                                 â†’ TransactionCanceledException
 |                                 â†’ 400 CARD_LIMIT_EXCEEDED
 v
```

---

## 5. ä¿®æ­£ç‰ˆ: å¾©ç¿’é€šçŸ¥ãƒ•ãƒ­ãƒ¼ (C-04) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *C-04: IAM ãƒãƒªã‚·ãƒ¼ä¿®æ­£ã®è¨­è¨ˆã‚ˆã‚Š*

**é–¢é€£è¦ä»¶**: REQ-CR-012

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚EventBridgeâ”‚    â”‚due-push-jobâ”‚    â”‚ DynamoDB â”‚     â”‚ LINE API â”‚
â”‚Scheduler â”‚     â”‚ (Lambda) â”‚     â”‚          â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚ 1. ãƒˆãƒªã‚¬ãƒ¼    â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 2. é€šçŸ¥å¯¾è±¡å–å¾— â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 3. å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ â”‚                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 4. LINE Push   â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 5. [FIX] last_notified_date æ›´æ–°â”‚
     â”‚                â”‚   (IAMæ¨©é™è¿½åŠ ã§ UpdateItem å¯èƒ½)â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 6. æ¬¡å›å®Ÿè¡Œæ™‚: â”‚                â”‚
     â”‚                â”‚   é€šçŸ¥æ¸ˆã¿ã‚¹ã‚­ãƒƒãƒ—               â”‚
     â”‚                â”‚                â”‚                â”‚
```

**Before (å¤±æ•—)**: IAM ã« UpdateItem æ¨©é™ãªã— â†’ ã‚¹ãƒ†ãƒƒãƒ— 5 ãŒ AccessDeniedException
**After (ä¿®æ­£å¾Œ)**: IAM ã« `dynamodb:UpdateItem` è¿½åŠ  â†’ ã‚¹ãƒ†ãƒƒãƒ— 5 ãŒæˆåŠŸ

---

## 6. ä¿®æ­£ç‰ˆ: ProtectedRoute ãƒ•ãƒ­ãƒ¼ (H-09) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *H-09: React ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ä»•æ§˜ã‚ˆã‚Š*

**é–¢é€£è¦ä»¶**: REQ-CR-008, REQ-CR-104

```
ProtectedRoute ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼:

                    ãƒã‚¦ãƒ³ãƒˆ
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ isLoading = true â”‚
              â”‚ â†’ Loadingè¡¨ç¤º    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ isLoading = false
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ isAuthenticated? â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   â”‚Yes     â”‚No
                   â–¼        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚children â”‚ â”‚ loginAttempted?    â”‚
              â”‚è¡¨ç¤º     â”‚ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚No        â”‚Yes
                            â–¼          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ [NEW]        â”‚ â”‚ Loading  â”‚
                    â”‚ useEffect:   â”‚ â”‚ è¡¨ç¤º     â”‚
                    â”‚ login()      â”‚ â”‚ (å†è©¦è¡Œ  â”‚
                    â”‚ setAttempted â”‚ â”‚  ãªã—)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚æˆåŠŸ         â”‚å¤±æ•—
                    â–¼             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ èªè¨¼å¾Œ    â”‚ â”‚ [NEW]    â”‚
              â”‚ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆâ”‚ â”‚ ã‚¨ãƒ©ãƒ¼ç”»é¢â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Before (ç„¡é™ãƒ«ãƒ¼ãƒ—)**: render ä¸­ã« `login()` â†’ å¤±æ•— â†’ å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â†’ `login()` â†’ ...
**After (ä¿®æ­£å¾Œ)**: `useEffect` + `loginAttempted` ãƒ•ãƒ©ã‚°ã§ 1 å›ã®ã¿å®Ÿè¡Œ

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£ãƒ•ãƒ­ãƒ¼

### 204 ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç† (C-05) ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *C-05: HTTP ä»•æ§˜ã‚ˆã‚Š*

```
Frontend API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†:

   ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ status OK?   â”‚
  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
     â”‚No      â”‚Yes
     â–¼        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚throw â”‚ â”‚ status === 204?â”‚
  â”‚Error â”‚ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚Yes       â”‚No
              â–¼          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ [NEW]    â”‚ â”‚ return       â”‚
        â”‚ return   â”‚ â”‚ response     â”‚
        â”‚ undefinedâ”‚ â”‚ .json()      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é–¢é€£æ–‡æ›¸

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: [architecture.md](architecture.md)
- **API ä»•æ§˜**: [api-endpoints.md](api-endpoints.md)
- **è¦ä»¶å®šç¾©**: [requirements.md](../../spec/code-review-remediation/requirements.md)
- **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: [dataflow.md](../memoru-liff/dataflow.md)

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| ãƒ¬ãƒ™ãƒ« | ä»¶æ•° | å‰²åˆ |
|--------|------|------|
| ğŸ”µ é’ä¿¡å· | 8ä»¶ | 89% |
| ğŸŸ¡ é»„ä¿¡å· | 1ä»¶ | 11% |
| ğŸ”´ èµ¤ä¿¡å· | 0ä»¶ | 0% |

**å“è³ªè©•ä¾¡**: âœ… é«˜å“è³ªï¼ˆé’ä¿¡å·ãŒ89%ã€èµ¤ä¿¡å·ãªã—ï¼‰
