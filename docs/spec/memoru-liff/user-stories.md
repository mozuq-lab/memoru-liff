# memoru-liff ユーザストーリー

**作成日**: 2026-01-05
**関連要件定義**: [requirements.md](requirements.md)
**ヒアリング記録**: [interview-record.md](interview-record.md)

**【信頼性レベル凡例】**:

- 🔵 **青信号**: PRD・設計文書・ユーザヒアリングを参考にした確実なストーリー
- 🟡 **黄信号**: PRD・設計文書・ユーザヒアリングから妥当な推測によるストーリー
- 🔴 **赤信号**: PRD・設計文書・ユーザヒアリングにない推測によるストーリー

---

## エピック1: 認証・ユーザー管理

### ストーリー 1.1: Keycloakログイン 🔵

**信頼性**: 🔵 *PRD第3章より*

**私は** 暗記アプリを使いたいユーザー **として**
**LIFFアプリにアクセスしてログインしたい**
**そうすることで** 自分のカードを安全に管理できる

**関連要件**: REQ-001, REQ-002, REQ-101

**詳細シナリオ**:

1. ユーザーがLINEアプリ内でLIFFを開く
2. 未ログインの場合、Keycloakログイン画面にリダイレクト
3. ユーザーがLINEアカウントでログイン（Identity Provider経由）
4. 認証成功後、LIFFアプリのホーム画面に遷移
5. JWTがローカルストレージに保存される

**前提条件**:

- Keycloakが稼働している
- LINE Identity Providerが設定されている

**制約事項**:

- PKCE フローを使用
- HTTPS必須

**優先度**: Must Have

---

### ストーリー 1.2: LINE連携 🔵

**信頼性**: 🔵 *PRD第2章より*

**私は** ログイン済みユーザー **として**
**LINEアカウントとKeycloakアカウントを紐づけたい**
**そうすることで** LINEで復習通知を受け取れる

**関連要件**: REQ-003, REQ-202

**詳細シナリオ**:

1. ユーザーがLIFF内で「LINE連携」ボタンをタップ
2. LIFF SDKで `liff.getProfile()` を呼び出し
3. `line_user_id` をバックエンドAPIに送信
4. `users` テーブルに `line_user_id` を保存
5. 連携完了メッセージを表示

**前提条件**:

- ユーザーがKeycloakにログイン済み
- LIFFアプリがLINEアプリ内で開かれている

**優先度**: Must Have

---

## エピック2: AIカード生成（MVP）

### ストーリー 2.1: テキストからカード生成 🔵

**信頼性**: 🔵 *PRD第2章・ユーザヒアリングより*

**私は** 効率的に学習したいユーザー **として**
**テキストを入力してAIにフラッシュカードを生成してもらいたい**
**そうすることで** 手動でカードを作成する手間を省ける

**関連要件**: REQ-021, REQ-022, REQ-023, REQ-024

**詳細シナリオ**:

1. ユーザーがLIFFで「AIカード生成」画面を開く
2. 学習したいテキスト（最大2,000文字）を入力
3. 「生成」ボタンをタップ
4. Bedrock APIでカード候補を生成（表面・裏面のペア）
5. 生成されたカード候補を一覧表示
6. ユーザーが内容を確認・編集
7. 「保存」ボタンでカードを保存

**前提条件**:

- ユーザーがログイン済み
- カード数が2,000枚未満

**制約事項**:

- 入力テキストは2,000文字以内
- 生成失敗時はエラー表示のみ

**優先度**: Must Have

---

### ストーリー 2.2: 生成エラー時のリトライ 🔵

**信頼性**: 🔵 *ユーザヒアリングより*

**私は** AIカード生成を試みたユーザー **として**
**生成失敗時にエラー内容を確認して再試行したい**
**そうすることで** 問題を把握して対処できる

**関連要件**: REQ-111, EDGE-001

**詳細シナリオ**:

1. AIカード生成リクエストが失敗
2. エラーメッセージを画面に表示
3. ユーザーが入力内容を確認・修正
4. 「再生成」ボタンで再試行

**前提条件**:

- AI生成リクエストが実行された

**優先度**: Must Have

---

## エピック3: カード管理

### ストーリー 3.1: カード手動作成 🟡

**信頼性**: 🟡 *PRDから妥当な推測*

**私は** 自分でカードを作りたいユーザー **として**
**表面・裏面を入力してカードを作成したい**
**そうすることで** AIに頼らず自由にカードを作成できる

**関連要件**: REQ-011, REQ-013

**詳細シナリオ**:

1. ユーザーがLIFFで「カード作成」画面を開く
2. 表面（問題）と裏面（答え）を入力
3. 「保存」ボタンでカードを保存
4. SRSパラメータが初期値で設定される

**前提条件**:

- ユーザーがログイン済み
- カード数が2,000枚未満

**優先度**: Should Have

---

### ストーリー 3.2: カード一覧閲覧 🟡

**信頼性**: 🟡 *PRDから妥当な推測*

**私は** 自分のカードを管理したいユーザー **として**
**保存済みカードの一覧を閲覧したい**
**そうすることで** 学習状況を把握できる

**関連要件**: REQ-014

**詳細シナリオ**:

1. ユーザーがLIFFで「カード一覧」画面を開く
2. 保存済みカードがリスト表示される
3. 各カードに次回復習日（due）が表示される
4. カードをタップして詳細を確認

**優先度**: Should Have

---

### ストーリー 3.3: カード編集・削除 🟡

**信頼性**: 🟡 *PRDから妥当な推測*

**私は** カード内容を修正したいユーザー **として**
**既存カードを編集または削除したい**
**そうすることで** 間違いを修正したり不要なカードを整理できる

**関連要件**: REQ-013

**詳細シナリオ**:

1. ユーザーがカード詳細画面を開く
2. 「編集」ボタンで編集モードに切り替え
3. 表面・裏面を修正して保存
4. または「削除」ボタンでカードを削除

**優先度**: Should Have

---

## エピック4: LINE復習通知（MVP）

### ストーリー 4.1: 復習リマインダー受信 🔵

**信頼性**: 🔵 *PRD第2章・ユーザヒアリングより*

**私は** 忘れずに復習したいユーザー **として**
**復習期限のカードがあるときLINEで通知を受け取りたい**
**そうすることで** 最適なタイミングで復習できる

**関連要件**: REQ-041, REQ-042, REQ-201

**詳細シナリオ**:

1. EventBridge Schedulerが定期的にLambdaを起動
2. 復習期限（due）が到来したカードを持つユーザーを検索
3. 対象ユーザーにFlex Messageで通知を送信
4. 通知には復習対象カード数と「復習開始」ボタンを含む
5. ユーザーがLINEで通知を受信

**前提条件**:

- ユーザーがLINE連携済み
- 復習期限のカードが存在

**優先度**: Must Have

---

### ストーリー 4.2: 通知時間設定 🔵

**信頼性**: 🔵 *ユーザヒアリングより*

**私は** 自分のペースで学習したいユーザー **として**
**復習通知の時間を自分で設定したい**
**そうすることで** 学習しやすい時間に通知を受け取れる

**関連要件**: REQ-043

**詳細シナリオ**:

1. ユーザーがLIFFで「設定」画面を開く
2. 通知時間を選択（例: 9:00, 12:00, 18:00, 21:00）
3. 「保存」ボタンで設定を保存
4. 指定時間に通知が届くようになる

**前提条件**:

- ユーザーがLINE連携済み

**優先度**: Must Have

---

## エピック5: LINE復習回答

### ストーリー 5.1: LINEで復習回答 🔵

**信頼性**: 🔵 *PRD第2章より*

**私は** 手軽に復習したいユーザー **として**
**LINEアプリ内で復習問題に回答したい**
**そうすることで** LIFFを開かずに素早く復習できる

**関連要件**: REQ-051, REQ-052, REQ-032

**詳細シナリオ**:

1. 通知の「復習開始」ボタンをタップ
2. カードの表面（問題）がFlex Messageで表示
3. ユーザーが心の中で回答を考える
4. 「答えを見る」ボタンで裏面（答え）を表示
5. 自己採点ボタン（0-5の6段階）をタップ
6. Postbackで採点結果を送信
7. SRSパラメータが更新され、次のカードを表示

**前提条件**:

- 復習対象カードが存在

**優先度**: Should Have

---

## ストーリーマップ

```
エピック1: 認証・ユーザー管理
├── ストーリー 1.1 Keycloakログイン (🔵 Must Have)
└── ストーリー 1.2 LINE連携 (🔵 Must Have)

エピック2: AIカード生成（MVP）
├── ストーリー 2.1 テキストからカード生成 (🔵 Must Have)
└── ストーリー 2.2 生成エラー時のリトライ (🔵 Must Have)

エピック3: カード管理
├── ストーリー 3.1 カード手動作成 (🟡 Should Have)
├── ストーリー 3.2 カード一覧閲覧 (🟡 Should Have)
└── ストーリー 3.3 カード編集・削除 (🟡 Should Have)

エピック4: LINE復習通知（MVP）
├── ストーリー 4.1 復習リマインダー受信 (🔵 Must Have)
└── ストーリー 4.2 通知時間設定 (🔵 Must Have)

エピック5: LINE復習回答
└── ストーリー 5.1 LINEで復習回答 (🔵 Should Have)
```

---

## 信頼性レベルサマリー

| レベル | 件数 | 割合 |
|--------|------|------|
| 🔵 青信号 | 8件 | 73% |
| 🟡 黄信号 | 3件 | 27% |
| 🔴 赤信号 | 0件 | 0% |

**品質評価**: ✅ 高品質（青信号が70%以上）

---

## MVP vs Phase 2 整理

### MVP（Phase 1）

| ストーリー | 優先度 |
|------------|--------|
| 1.1 Keycloakログイン | Must Have |
| 1.2 LINE連携 | Must Have |
| 2.1 テキストからカード生成 | Must Have |
| 2.2 生成エラー時のリトライ | Must Have |
| 4.1 復習リマインダー受信 | Must Have |
| 4.2 通知時間設定 | Must Have |

### Phase 2

| ストーリー | 優先度 |
|------------|--------|
| 3.1 カード手動作成 | Should Have |
| 3.2 カード一覧閲覧 | Should Have |
| 3.3 カード編集・削除 | Should Have |
| 5.1 LINEで復習回答 | Should Have |
