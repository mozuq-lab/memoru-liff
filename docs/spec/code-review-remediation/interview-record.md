# code-review-remediation ヒアリング記録

**作成日**: 2026-02-15
**ヒアリング実施**: step4 既存情報ベースの差分ヒアリング

## ヒアリング目的

コードレビュー結果（Critical 7 件 + High 12 件 + Medium 14 件 + Low 10 件 + Info 5 件）から、修正対象のスコープ・アプローチ・優先順位を明確化するためのヒアリングを実施しました。

## 質問と回答

### Q1: 対応スコープの確認

**質問日時**: 2026-02-15
**カテゴリ**: 優先順位
**背景**: レビュー結果に 48 件の指摘があり、全件対応は工数が大きいため、優先度の高い項目に絞る必要があった。

**質問**: 今回の修正対象とする指摘のスコープを教えてください。

**回答**: Critical + High のみ（19 件）

**信頼性への影響**:
- 対象スコープが明確になり、全 REQ-CR-xxx の信頼性レベルが 🔵 に確定
- Medium 以下の項目は別途対応として除外

---

### Q2: インフラ変更の包含

**質問日時**: 2026-02-15
**カテゴリ**: 影響範囲
**背景**: High レベルの指摘に NAT Gateway コスト最適化（H-11）、CloudWatch Logs 保存期間（H-12）、CSP ヘッダー（H-02）、Keycloak HTTPS（H-03）などインフラ変更を伴う項目が含まれていた。

**質問**: インフラ（CloudFormation テンプレート）の変更を含めますか？

**回答**: 含める

**信頼性への影響**:
- REQ-CR-010, 011, 012, 412, 413, 414 の信頼性が 🔵 に確定
- インフラ変更を含む包括的な修正計画が策定可能に

---

### Q3: API 契約統一のアプローチ

**質問日時**: 2026-02-15
**カテゴリ**: 未定義部分詳細化
**背景**: C-01（API ルート不一致）と C-02（レスポンス契約不一致）の修正方法として、OpenAPI スキーマ自動生成を導入するか、手動で統一するかの選択が必要だった。

**質問**: API 契約の統一方法について、どのアプローチを採用しますか？

**回答**: 手動統一（OpenAPI スキーマ自動生成は導入しない）

**信頼性への影響**:
- REQ-CR-401 が 🔵 に確定（手動統一の制約）
- C-02 の対応が型定義ファイルの手動修正に明確化

---

### Q4: テスト要件の確認

**質問日時**: 2026-02-15
**カテゴリ**: 追加要件
**背景**: 修正に伴うテストの範囲（既存テスト更新のみ / 新規テスト追加 / E2E テスト含む）を確認する必要があった。

**質問**: テスト要件について教えてください。

**回答**: 既存テストの更新 + 回帰テスト確認（E2E skip 解除は対象外）

**信頼性への影響**:
- REQ-CR-402 が 🔵 に確定
- テスト範囲が明確になり、受け入れ基準のテストケース設計が可能に

---

### Q5: Phase 構成の確認

**質問日時**: 2026-02-15
**カテゴリ**: 優先順位
**背景**: Critical と High を別 Phase に分けるか、一括で対応するかの確認。

**質問**: Phase 構成について教えてください。

**回答**: 推奨 Phase 構成でOK（Phase 1: Critical 7 件、Phase 2: High 12 件）

**信頼性への影響**:
- 全体のスケジュール感が 🔵 に確定
- Phase 1 は 1 週間以内、Phase 2 は 2 週間以内の目標が承認

---

### Q6: C-06 タイミング攻撃への対応可否

**質問日時**: 2026-02-15
**カテゴリ**: 既存設計確認
**背景**: LINE 署名検証のタイミング攻撃リスク（C-06）は、セキュリティ上重要だが実際の攻撃リスクは低い可能性があったため、対応するかの判断を確認。

**質問**: C-06（LINE 署名検証のタイミング攻撃リスク）に対応しますか？

**回答**: 対応する

**信頼性への影響**:
- REQ-CR-009 が 🔵 に確定
- EDGE-CR-001（空署名のハンドリング）も対応対象に含まれることが確認

---

## ヒアリング結果サマリー

### 確認できた事項

- 対象スコープ: Critical 7 件 + High 12 件 = 合計 19 件
- インフラ変更を含む包括的な修正
- API 契約は手動統一（OpenAPI 未導入）
- 既存テスト更新 + 回帰テスト（E2E skip 解除は除外）
- Phase 1（Critical / 1週間）→ Phase 2（High / 2週間）の段階的対応
- C-06 タイミング攻撃対策は実施

### 追加/変更要件

- 特になし（コードレビュー結果の対応スコープ確定が主目的）

### 残課題

- Medium レベル 14 件の対応時期は未定（別途要件定義が必要）
- CSP の `unsafe-inline` 除去方針（nonce ベース vs hash ベース）の詳細設計
- トークンリフレッシュの具体的な実装パターン（interceptor vs wrapper）

### 信頼性レベル分布

**ヒアリング前**:

- 🔵 青信号: 19件
- 🟡 黄信号: 19件
- 🔴 赤信号: 3件

**ヒアリング後**:

- 🔵 青信号: 30件 (+11)
- 🟡 黄信号: 11件 (-8)
- 🔴 赤信号: 0件 (-3)

## 関連文書

- **要件定義書**: [requirements.md](requirements.md)
- **ユーザストーリー**: [user-stories.md](user-stories.md)
- **受け入れ基準**: [acceptance-criteria.md](acceptance-criteria.md)
- **コードレビュー結果**: [CODE_REVIEW_2026-02-15.md](../../CODE_REVIEW_2026-02-15.md)
